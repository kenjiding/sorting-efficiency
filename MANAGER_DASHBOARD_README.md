# 总经理仪表板功能说明

## 功能概述

本系统新增了**总经理仪表板（Manager Dashboard）**功能，专为公司高层管理人员设计，提供跨区域的效率数据对比和可视化分析。

## 主要特点

### 1. 权限控制系统

#### 用户角色体系
- **普通用户 (user)**: 基础权限
- **管理员 (admin)**: 管理权限
- **总经理 (ceo)**: 最高权限，可访问所有功能

#### 默认账户
```
管理员账户: admin / admin123
总经理账户: ceo / ceo123
```

#### 权限特性
- 只有 **CEO/总经理** 角色可以访问总经理仪表板
- 其他用户无法在侧边栏看到该菜单项
- 尝试直接访问会显示权限拒绝页面
- 自动角色层级验证（ceo > admin > user）

### 2. 总经理仪表板核心功能

#### 2.1 总览视图 (Overview)
- **关键指标卡片**
  - 总处理量：跨所有区域的包裹处理总数
  - 总工人数：所有区域的工人总数
  - 总工作时长：所有区域的工作小时总和
  - 平均效率：跨区域的平均处理效率

- **可视化图表**
  - 区域效率对比柱状图（总体效率、粗拣效率、细拣效率）
  - 处理量分布饼图
  - 工人数分布饼图

- **区域详细数据表格**
  - 展示每个区域的详细统计数据
  - 包含处理量、工人数、工作时长、各类效率指标

#### 2.2 区域排名视图 (Rankings)
- **可配置排名指标**
  - 总体效率排名
  - 处理总量排名
  - 粗拣效率排名
  - 细拣效率排名

- **视觉化排名展示**
  - 前三名采用特殊配色（金、银、铜）
  - 显示奖章图标
  - 展示各区域关键数据

#### 2.3 详细对比视图 (Comparison)
- **按区域展开的工人详情**
  - 每个区域的工人列表
  - 工人个人效率数据
  - 粗拣和细拣数量明细
  - 自动按效率排序

- **区域汇总统计**
  - 区域总处理量
  - 区域平均效率
  - 工人数量统计

### 3. 数据分析功能

#### 日期范围筛选
- 支持自定义日期范围查询
- 默认显示最近7天数据
- 实时数据刷新按钮

#### 多维度对比
- 跨区域横向对比
- 区域内工人纵向对比
- 多指标综合分析

## 技术实现

### 前端架构

#### 新增组件
```
src/components/
├── ManagerDashboard.jsx     # 总经理仪表板主组件
├── ProtectedRoute.jsx        # 权限保护路由组件
└── Layout/
    └── Sidebar.jsx           # 更新：支持角色菜单过滤
```

#### 状态管理
```javascript
// 新增 store 功能
- hasPermission(requiredRole): 权限检查函数
- 用户角色管理
- CEO 账户初始化
```

#### 路由配置
```javascript
// App.jsx
<Route 
  path="/manager" 
  element={
    <ProtectedRoute requiredRole="ceo">
      <ManagerDashboard />
    </ProtectedRoute>
  } 
/>
```

### 后端 API

#### 新增跨区域路由
```
server/routes/crossRegion.js
```

#### API 端点

| 端点 | 方法 | 描述 |
|------|------|------|
| `/api/cross-region/summary` | GET | 获取所有区域的汇总统计 |
| `/api/cross-region/rankings` | GET | 获取区域排名数据 |
| `/api/cross-region/comparison` | GET | 获取区域详细对比数据 |
| `/api/cross-region/efficiency-history` | GET | 获取跨区域效率历史记录 |

#### 查询参数
- `startDate`: 开始日期（可选）
- `endDate`: 结束日期（可选）
- `metric`: 排名指标（efficiency, totalItems, coarseEfficiency, fineEfficiency）

### 数据结构

#### 区域汇总数据
```javascript
{
  regions: [
    {
      region: "SYD",
      totalRecords: 100,
      totalItems: 5000,
      totalWorkingHours: 120.5,
      avgCoarseEfficiency: 450.5,
      avgFineEfficiency: 380.2,
      overallEfficiency: 415.3,
      workerCount: 10,
      workers: ["张三", "李四", ...]
    },
    // ... 其他区域
  ],
  totalAcrossRegions: {
    records: 500,
    items: 25000,
    workingHours: 602.5,
    workers: 50
  }
}
```

## 使用说明

### 1. 登录总经理账户
使用 CEO 账户登录系统：
- 用户名：`ceo`
- 密码：`ceo123`

### 2. 访问总经理仪表板
- 登录后，侧边栏会显示"总经理仪表板"菜单项（带皇冠图标 👑）
- 点击进入仪表板页面

### 3. 查看数据
- **总览视图**：查看跨区域的总体数据和对比
- **区域排名**：查看各区域的排名情况，可切换不同排名指标
- **详细对比**：查看每个区域内工人的详细数据

### 4. 筛选数据
- 使用顶部的日期选择器选择时间范围
- 点击刷新按钮重新加载数据

### 5. 权限测试
使用普通管理员账户（`admin/admin123`）登录时：
- 侧边栏不会显示"总经理仪表板"菜单
- 直接访问 `/manager` 会显示权限拒绝页面

## 区域配置

系统支持以下区域：

| 代码 | 名称 | 图标 |
|------|------|------|
| SA | 南澳 | 🏖️ |
| SYD | 悉尼 | 🌉 |
| MEL | 墨尔本 | 🏙️ |
| BNE | 布里斯班 | ☀️ |
| PER | 珀斯 | 🌅 |

## UI 设计特点

### 配色方案
- **蓝色渐变**: 主题色，用于标题和主要指标
- **紫色渐变**: 辅助色，用于次要信息
- **语义化配色**: 
  - 蓝色: 总体数据
  - 绿色: 工人/人员相关
  - 紫色: 时间相关
  - 橙色: 效率指标

### 视觉层次
- 大标题和渐变背景突出重要性
- 卡片式布局清晰分隔内容
- 图表和表格结合，多维度展示数据
- 响应式设计，适配各种屏幕尺寸

### 交互设计
- 平滑的动画过渡
- 悬停效果增强可点击性
- Loading 状态提示
- 错误友好的提示信息

## 未来扩展建议

1. **导出功能**
   - 添加导出 Excel/PDF 报告功能
   - 支持自定义报告模板

2. **数据对比**
   - 添加时间段对比功能
   - 同比/环比增长率分析

3. **预警功能**
   - 效率低于阈值自动预警
   - 区域异常数据提醒

4. **更多图表**
   - 趋势折线图（时间序列）
   - 雷达图（多维度对比）
   - 热力地图（区域分布）

5. **移动端优化**
   - 响应式布局优化
   - 移动端专用界面

## 注意事项

1. **数据隐私**: 总经理仪表板显示敏感的跨区域数据，请妥善保管 CEO 账户密码
2. **性能考虑**: 大量数据查询可能需要较长时间，建议合理设置日期范围
3. **权限安全**: 不要将 CEO 权限随意授予其他用户
4. **数据准确性**: 确保各区域的数据录入及时准确，以保证仪表板数据的真实性

## 问题排查

### 无法访问总经理仪表板
- 检查是否使用 CEO 账户登录
- 清除浏览器缓存后重新登录

### 数据不显示
- 检查后端服务器是否正常运行
- 检查 MongoDB 数据库连接
- 查看浏览器控制台错误信息

### 权限验证失败
- 确认用户角色设置正确
- 重新初始化用户数据（清除 localStorage 后刷新）

## 技术支持

如有问题，请联系系统开发团队。

